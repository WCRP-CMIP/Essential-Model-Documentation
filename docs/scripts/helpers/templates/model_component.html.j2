{% extends "base.html.j2" %}

{% block title %}{{ name | e }} | Model Component{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ depth }}stylesheets/scientific_domains.css">
<style>
/* â”€â”€ Domain accent header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.emd-header.has-domain {
    border-left: 4px solid var(--sd-color, var(--emd-primary));
}
/* â”€â”€ Plain-language callout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.plain-summary {
    background: rgba(37,99,235,0.05);
    border-radius: var(--emd-radius);
    padding: 1rem 1.25rem;
    margin-bottom: 1.25rem;
    font-size: 0.95rem;
    line-height: 1.7;
    color: var(--emd-text);
}
.plain-summary strong { color: var(--emd-primary); }
/* â”€â”€ Domain pill in header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.emd-domain-pill {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    font-size: 0.78rem;
    font-weight: 700;
    padding: 0.25rem 0.7rem;
    border-radius: 9999px;
    border: 1.5px solid var(--sd-color, var(--emd-primary));
    background: var(--sd-bg, #eff6ff);
    color: var(--sd-color, var(--emd-primary));
    margin-bottom: 0.75rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
}
/* â”€â”€ Family link card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.family-link-card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.85rem 1.1rem;
    background: var(--emd-bg);
    border: 1px solid var(--emd-border);
    border-radius: var(--emd-radius);
    text-decoration: none;
    color: var(--emd-text);
    transition: box-shadow 0.2s, border-color 0.2s;
}
.family-link-card:hover { box-shadow: var(--emd-shadow); border-color: var(--emd-primary); }
.family-link-card-name { font-weight: 600; font-size: 1rem; }
.family-link-card-label { font-size: 0.75rem; color: var(--emd-text-muted); margin-top: 0.15rem; }
.family-link-arrow { font-size: 1.2rem; color: var(--emd-text-muted); }
</style>
{% endblock %}

{% block breadcrumb_extra %}
<span>â†’</span>
<a href="https://emd.mipcvs.dev/model_component/" target="_blank">Model Components</a>
<span>â†’</span>
<span>{{ name | e }}</span>
{% endblock %}

{% block page_header %}
{% if component_domain %}
<div class="emd-domain-pill sd-{{ component_domain.domain_key }}">
    {{ component_domain.name | e }}
</div>
{% endif %}
<div class="emd-badge">Model Component</div>
<h1 class="emd-title">{{ name | e }}</h1>
{% if validation_key and validation_key != name %}
<p class="emd-long-name">{{ validation_key | e }}</p>
{% endif %}
<p class="emd-subtitle">{{ description | e }}</p>
<div class="emd-header-meta">
    {% if family %}
    <div class="emd-meta-item">
        <span class="emd-meta-label">Family</span>
        <span class="emd-meta-value">
            {% if family.page %}<a href="{{ family.page | e }}">{{ family.name | e }}</a>
            {% else %}{{ family.name | e }}{% endif %}
        </span>
    </div>
    {% endif %}
    {% if component_domain %}
    <div class="emd-meta-item">
        <span class="emd-meta-label">Scientific Domain</span>
        <span class="emd-meta-value">{{ component_domain.name | e }}</span>
    </div>
    {% endif %}
    <div class="emd-meta-item">
        <span class="emd-meta-label">Code Base</span>
        <span class="emd-meta-value">
            {%- if code_base.is_private -%}ðŸ”’ Private
            {%- elif code_base.is_url -%}<a href="{{ code_base.value | e }}" target="_blank">{{ code_base.value | replace('https://', '') | e }}</a>
            {%- elif code_base.value -%}{{ code_base.value | e }}
            {%- else -%}Not specified{%- endif -%}
        </span>
    </div>
    <div class="emd-meta-item">
        <span class="emd-meta-label">Registry</span>
        <span class="emd-meta-value"><a href="{{ context_url | e }}" target="_blank">JSON-LD â†’</a></span>
    </div>
</div>
{% endblock %}

{% block content %}

{# â”€â”€ Plain-language summary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<div class="plain-summary">
    <strong>What is this?</strong>
    {{ name | e }} is a <strong>model component</strong> that simulates the
    {% if component_domain %}<strong>{{ component_domain.name | e }}</strong>{% else %}physical{% endif %}
    processes within an Earth system model.
    {% if family %}It belongs to the <strong>{{ family.name | e }}</strong> model family.{% endif %}
    {% if code_base.is_private %}The source code is kept private.
    {% elif code_base.is_url %}The source code is publicly available.{% endif %}
</div>

{# â”€â”€ Description â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<section class="emd-section expanded">
    <div class="emd-section-header" onclick="toggleSection(this)">
        <div class="emd-section-title-wrapper">
            <div class="emd-section-icon">{{ icons.description | safe }}</div>
            <h2 class="emd-section-title">Scientific Description</h2>
        </div>
        <div class="emd-section-toggle">{{ icons.chevron | safe }}</div>
    </div>
    <div class="emd-section-content">
        <div class="emd-section-body">
            <div class="emd-section-divider"></div>
            <p class="emd-description-text">{{ description_highlighted | safe }}</p>
        </div>
    </div>
</section>

{# â”€â”€ Scientific Domain â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% if component_domain %}
<section class="emd-section expanded">
    <div class="emd-section-header" onclick="toggleSection(this)">
        <div class="emd-section-title-wrapper">
            <div class="emd-section-icon">{{ icons.domain | safe }}</div>
            <h2 class="emd-section-title">Scientific Domain</h2>
        </div>
        <div class="emd-section-toggle">{{ icons.chevron | safe }}</div>
    </div>
    <div class="emd-section-content">
        <div class="emd-section-body">
            <div class="emd-section-divider"></div>
            <div class="emd-domains-grid">
                <div class="emd-domain-card sd-{{ component_domain.domain_key }}">
                    <div class="emd-domain-card-header">
                        <span class="emd-domain-card-title">{{ component_domain.name | e }}</span>
                        <span class="emd-domain-card-type">Component Type</span>
                    </div>
                    <div class="emd-domain-card-id">{{ component_domain.id | e }}</div>
                    {% if component_domain.description %}
                    <p class="emd-domain-card-description">{{ component_domain.description | e }}</p>
                    {% endif %}
                </div>
            </div>
            <p style="margin-top:1rem;font-size:0.875rem;color:var(--emd-text-muted);">
                Grid configurations for this component are defined per model in the component_config entries.
            </p>
        </div>
    </div>
</section>
{% endif %}

{# â”€â”€ Model Family â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% if family %}
<section class="emd-section expanded">
    <div class="emd-section-header" onclick="toggleSection(this)">
        <div class="emd-section-title-wrapper">
            <div class="emd-section-icon">{{ icons.tech | safe }}</div>
            <h2 class="emd-section-title">Model Family</h2>
        </div>
        <div class="emd-section-toggle">{{ icons.chevron | safe }}</div>
    </div>
    <div class="emd-section-content">
        <div class="emd-section-body">
            <div class="emd-section-divider"></div>
            <a class="family-link-card" href="{{ family.page | e }}">
                <div>
                    <div class="family-link-card-name">{{ family.name | e }}</div>
                    <div class="family-link-card-label">Component Family â†’ View full family page</div>
                </div>
                <span class="family-link-arrow">â†’</span>
            </a>
            {% if family.description %}
            <p class="emd-description-text" style="margin-top:1rem;">{{ family.description | e }}</p>
            {% endif %}
        </div>
    </div>
</section>
{% endif %}

{# â”€â”€ References â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% set ref_count = references | length if references else 0 %}
<section class="emd-section{% if ref_count > 0 %} expanded{% endif %}">
    <div class="emd-section-header" onclick="toggleSection(this)">
        <div class="emd-section-title-wrapper">
            <div class="emd-section-icon">{{ icons.reference | safe }}</div>
            <h2 class="emd-section-title">References <span class="emd-section-count">({{ ref_count }})</span></h2>
        </div>
        <div class="emd-section-toggle">{{ icons.chevron | safe }}</div>
    </div>
    <div class="emd-section-content">
        <div class="emd-section-body">
            <div class="emd-section-divider"></div>
            {% if references %}
            {% for ref in references %}
            <a href="{{ ref | e }}" class="emd-reference-item" target="_blank">
                <div class="emd-reference-icon">{{ icons.description | safe }}</div>
                <span class="emd-reference-text">{{ ref | e }}</span>
                <span class="emd-reference-arrow">â†’</span>
            </a>
            {% endfor %}
            {% else %}
            <p class="emd-description-text">No references available.</p>
            {% endif %}
        </div>
    </div>
</section>

{# â”€â”€ Technical Details â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<section class="emd-section">
    <div class="emd-section-header" onclick="toggleSection(this)">
        <div class="emd-section-title-wrapper">
            <div class="emd-section-icon">{{ icons.tech | safe }}</div>
            <h2 class="emd-section-title">Technical Details</h2>
        </div>
        <div class="emd-section-toggle">{{ icons.chevron | safe }}</div>
    </div>
    <div class="emd-section-content">
        <div class="emd-section-body">
            <div class="emd-section-divider"></div>
            <div class="emd-tech-grid">
                <div class="emd-tech-item">
                    <div class="emd-tech-label">Resource Identifier (@id)</div>
                    <div class="emd-tech-value">{{ id | e }}</div>
                </div>
                <div class="emd-tech-item">
                    <div class="emd-tech-label">Validation Key</div>
                    <div class="emd-tech-value">{{ validation_key | e if validation_key else 'N/A' }}</div>
                </div>
                <div class="emd-tech-item">
                    <div class="emd-tech-label">JSON-LD Context</div>
                    <div class="emd-tech-value"><a href="{{ context_url | e }}" target="_blank">{{ context_url | replace('https://', '') | e }}</a></div>
                </div>
                <div class="emd-tech-item">
                    <div class="emd-tech-label">Resource Types</div>
                    <div class="emd-type-badges">
                        {% for t in types %}<span class="emd-type-badge">{{ t | e }}</span>{% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block scripts %}
{% if component_domain %}
// Apply domain colour to header left border
(function() {
    const pill = document.querySelector('.emd-domain-pill');
    const header = document.querySelector('.emd-header');
    if (pill && header) {
        const color = getComputedStyle(pill).getPropertyValue('--sd-color').trim();
        if (color) { header.classList.add('has-domain'); header.style.setProperty('--sd-color', color); }
    }
})();
{% endif %}
const sourceData = {{ raw_json | safe }};
document.addEventListener("copy", function(e) {
    e.preventDefault();
    e.clipboardData.setData("text/plain",
        "// JSON-LD: {{ name | e }}\n// Generated: {{ generated_date }}\n\n" +
        JSON.stringify(sourceData, null, 2));
});
{% endblock %}
