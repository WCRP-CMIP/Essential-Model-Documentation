{% extends "base.html.j2" %}

{% block title %}{{ name | e }} | {{ family_type }}{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ depth }}stylesheets/scientific_domains.css">
<style>
/* â”€â”€ Domain accent header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.emd-header.has-domain {
    border-left: 4px solid var(--sd-color, var(--emd-primary));
}
/* â”€â”€ Plain-language callout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.plain-summary {
    background: rgba(37,99,235,0.05);
    border-radius: var(--emd-radius);
    padding: 1rem 1.25rem;
    margin-bottom: 1.25rem;
    font-size: 0.95rem;
    line-height: 1.7;
}
.plain-summary strong { color: var(--emd-primary); }
/* â”€â”€ Domain pills row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.domain-pills-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    margin-bottom: 0.75rem;
}
.emd-domain-pill {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    font-size: 0.75rem;
    font-weight: 700;
    padding: 0.2rem 0.65rem;
    border-radius: 9999px;
    border: 1.5px solid var(--sd-color, var(--emd-primary));
    background: var(--sd-bg, #eff6ff);
    color: var(--sd-color, var(--emd-primary));
    letter-spacing: 0.04em;
    text-transform: uppercase;
}
/* â”€â”€ Scientific info card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sci-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
    margin-top: 0.5rem;
}
.sci-info-card {
    background: var(--emd-bg);
    border: 1px solid var(--emd-border);
    border-radius: var(--emd-radius);
    padding: 1rem 1.1rem;
}
.sci-info-card-label {
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    color: var(--emd-text-muted);
    margin-bottom: 0.4rem;
}
.sci-info-card-value {
    font-size: 0.9rem;
    color: var(--emd-text);
    line-height: 1.55;
}
/* â”€â”€ Scientific domain chips (small squares) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.domain-chips-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 0.6rem;
}
.domain-chip {
    width: 120px;
    height: 120px;
    border-left: 4px solid var(--sd-color, var(--emd-border));
    border-top: 1px solid var(--emd-border);
    border-right: 1px solid var(--emd-border);
    border-bottom: 1px solid var(--emd-border);
    border-radius: var(--emd-radius);
    background: var(--emd-bg);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: flex-start;
    padding: 0.5rem 0.6rem;
    gap: 0.2rem;
}
.domain-chip-name {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--emd-text);
    line-height: 1.2;
}
.domain-chip-id {
    font-size: 0.65rem;
    color: var(--sd-color, var(--emd-text-muted));
    font-family: 'SF Mono', Monaco, monospace;
    opacity: 0.8;
}
.family-link-card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.85rem 1.1rem;
    background: var(--emd-bg);
    border: 1px solid var(--emd-border);
    border-radius: var(--emd-radius);
    text-decoration: none;
    color: var(--emd-text);
    transition: box-shadow 0.2s, border-color 0.2s;
    margin-bottom: 0.5rem;
}
.family-link-card:hover { box-shadow: var(--emd-shadow); border-color: var(--emd-primary); }
</style>
{% endblock %}

{% block breadcrumb_extra %}
<span>â†’</span>
<span>{{ family_type }}</span>
<span>â†’</span>
<span>{{ name | e }}</span>
{% endblock %}

{% block page_header %}
<div class="emd-badge">{{ family_type }}</div>
<h1 class="emd-title">{{ name | e }}</h1>
{% if validation_key and validation_key != name %}
<p class="emd-long-name">{{ validation_key | e }}</p>
{% endif %}
<p class="emd-subtitle">{{ description | e }}</p>
<div class="emd-header-meta">
    {% if primary_institution %}
    <div class="emd-meta-item">
        <span class="emd-meta-label">Primary Institution</span>
        <span class="emd-meta-value">
            {% if primary_institution.url %}
            <a href="{{ primary_institution.url | e }}" target="_blank">{{ primary_institution.name | e }}</a>
            {% else %}{{ primary_institution.name | e }}{% endif %}
        </span>
    </div>
    {% endif %}
    {% if scientific_domains %}
    <div class="emd-meta-item">
        <span class="emd-meta-label">Scientific Domains</span>
        <span class="emd-meta-value">{{ scientific_domains | map(attribute='name') | join(', ') }}</span>
    </div>
    {% endif %}
    {% if established and established != 'none' %}
    <div class="emd-meta-item">
        <span class="emd-meta-label">Established</span>
        <span class="emd-meta-value">{{ established }}</span>
    </div>
    {% endif %}
    {% if representative_member %}
    <div class="emd-meta-item">
        <span class="emd-meta-label">Representative Member</span>
        <span class="emd-meta-value">{{ representative_member | e }}</span>
    </div>
    {% endif %}
    {% if website %}
    <div class="emd-meta-item">
        <span class="emd-meta-label">Website</span>
        <span class="emd-meta-value"><a href="{{ website | e }}" target="_blank">{{ website | replace('https://', '') | replace('http://', '') | e }}</a></span>
    </div>
    {% endif %}
    <div class="emd-meta-item">
        <span class="emd-meta-label">Registry</span>
        <span class="emd-meta-value"><a href="{{ context_url | e }}" target="_blank">JSON-LD â†’</a></span>
    </div>
</div>
{% endblock %}

{% block content %}

{# â”€â”€ Plain-language summary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<div class="plain-summary">
    <strong>What is this?</strong>
    {{ name | e }} is an <strong>{{ family_type | lower }}</strong>
    {% if primary_institution %}developed by <strong>{{ primary_institution.name | e }}</strong>{% endif %}
    {% if established and established != 'none' %}, first established in <strong>{{ established }}</strong>{% endif %}.
    {% if scientific_domains %}
    It covers the
    <strong>{{ scientific_domains | map(attribute='name') | join(', ') }}</strong>
    {% if scientific_domains | length == 1 %}domain{% else %}domains{% endif %} of Earth system science.
    {% endif %}
    {% if representative_member %}The best-known member of this family is <strong>{{ representative_member | e }}</strong>.{% endif %}
</div>

{# â”€â”€ Scientific Domains (first) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% if scientific_domains %}
<section class="emd-section expanded">
    <div class="emd-section-header" onclick="toggleSection(this)">
        <div class="emd-section-title-wrapper">
            <div class="emd-section-icon">{{ icons.grid | safe }}</div>
            <h2 class="emd-section-title">Scientific Domains <span class="emd-section-count">({{ scientific_domains | length }})</span></h2>
        </div>
        <div class="emd-section-toggle">{{ icons.chevron | safe }}</div>
    </div>
    <div class="emd-section-content">
        <div class="emd-section-body">
            <div class="emd-section-divider"></div>
            <div class="domain-chips-grid">
            {% for domain in scientific_domains %}
            <div class="domain-chip sd-{{ domain.domain_key }}">
                <span class="domain-chip-name">{{ domain.name | e }}</span>
                <span class="domain-chip-id">{{ domain.id | e }}</span>
            </div>
            {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endif %}

{# â”€â”€ Description â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<section class="emd-section expanded">
    <div class="emd-section-header" onclick="toggleSection(this)">
        <div class="emd-section-title-wrapper">
            <div class="emd-section-icon">{{ icons.description | safe }}</div>
            <h2 class="emd-section-title">Description</h2>
        </div>
        <div class="emd-section-toggle">{{ icons.chevron | safe }}</div>
    </div>
    <div class="emd-section-content">
        <div class="emd-section-body">
            <div class="emd-section-divider"></div>
            <p class="emd-description-text">{{ description_highlighted | safe }}</p>
            {% if evolution %}
            <div class="sci-info-card" style="margin-top:1rem;">
                <div class="sci-info-card-label">Evolution &amp; History</div>
                <div class="sci-info-card-value">{{ evolution | e }}</div>
            </div>
            {% endif %}
            {% if common_scientific_basis %}
            <div class="sci-info-card" style="margin-top:0.75rem;">
                <div class="sci-info-card-label">Scientific Basis</div>
                <div class="sci-info-card-value">{{ common_scientific_basis | e }}</div>
            </div>
            {% endif %}
        </div>
    </div>
</section>

{# â”€â”€ Institutions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% if primary_institution or collaborative_institutions %}
<section class="emd-section expanded">
    <div class="emd-section-header" onclick="toggleSection(this)">
        <div class="emd-section-title-wrapper">
            <div class="emd-section-icon">{{ icons.domain | safe }}</div>
            <h2 class="emd-section-title">Institutions</h2>
        </div>
        <div class="emd-section-toggle">{{ icons.chevron | safe }}</div>
    </div>
    <div class="emd-section-content">
        <div class="emd-section-body">
            <div class="emd-section-divider"></div>
            <div class="emd-domains-grid">
            {% if primary_institution %}
            <div class="emd-domain-card">
                <div class="emd-domain-card-header">
                    <span class="emd-domain-card-title">
                        {% if primary_institution.url %}<a href="{{ primary_institution.url | e }}" target="_blank" style="color:inherit;text-decoration:none;">{{ primary_institution.name | e }}</a>
                        {% else %}{{ primary_institution.name | e }}{% endif %}
                    </span>
                    <span class="emd-domain-card-type">Primary</span>
                </div>
                {% if primary_institution.acronym %}
                <div class="emd-domain-card-id">{{ primary_institution.acronym | e }}</div>
                {% endif %}
                {% if primary_institution.location %}
                <p class="emd-domain-card-description">
                    {{ primary_institution.location.name | e }}{% if primary_institution.location.country %}, {{ primary_institution.location.country | e }}{% endif %}
                    {% if primary_institution.location.continent %} Â· {{ primary_institution.location.continent | e }}{% endif %}
                </p>
                {% endif %}
                <div class="emd-domain-card-meta">
                    {% if primary_institution.established %}<span class="emd-meta-tag">Est. {{ primary_institution.established }}</span>{% endif %}
                    {% if primary_institution.ror %}<a href="https://ror.org/{{ primary_institution.ror | e }}" target="_blank" class="emd-meta-tag">ROR â†—</a>{% endif %}
                </div>
            </div>
            {% endif %}
            {% for inst in collaborative_institutions %}
            <div class="emd-domain-card">
                <div class="emd-domain-card-header">
                    <span class="emd-domain-card-title">
                        {% if inst.url %}<a href="{{ inst.url | e }}" target="_blank" style="color:inherit;text-decoration:none;">{{ inst.name | e }}</a>
                        {% else %}{{ inst.name | e }}{% endif %}
                    </span>
                    <span class="emd-domain-card-type">Collaborative</span>
                </div>
                {% if inst.acronym %}<div class="emd-domain-card-id">{{ inst.acronym | e }}</div>{% endif %}
                {% if inst.location %}
                <p class="emd-domain-card-description">
                    {{ inst.location.name | e }}{% if inst.location.country %}, {{ inst.location.country | e }}{% endif %}
                </p>
                {% endif %}
                <div class="emd-domain-card-meta">
                    {% if inst.established %}<span class="emd-meta-tag">Est. {{ inst.established }}</span>{% endif %}
                    {% if inst.ror %}<a href="https://ror.org/{{ inst.ror | e }}" target="_blank" class="emd-meta-tag">ROR â†—</a>{% endif %}
                </div>
            </div>
            {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endif %}

{# â”€â”€ Scientific & Technical Characteristics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% set has_sci = common_scientific_basis or computational_requirements or variation_dimensions or software_dependencies %}
{% if has_sci %}
<section class="emd-section expanded">
    <div class="emd-section-header" onclick="toggleSection(this)">
        <div class="emd-section-title-wrapper">
            <div class="emd-section-icon">{{ icons.tech | safe }}</div>
            <h2 class="emd-section-title">Scientific &amp; Technical Characteristics</h2>
        </div>
        <div class="emd-section-toggle">{{ icons.chevron | safe }}</div>
    </div>
    <div class="emd-section-content">
        <div class="emd-section-body">
            <div class="emd-section-divider"></div>
            <div class="sci-info-grid">
                {% if computational_requirements %}
                <div class="sci-info-card">
                    <div class="sci-info-card-label">âš™ï¸ Computational Requirements</div>
                    <div class="sci-info-card-value">{{ computational_requirements | e }}</div>
                </div>
                {% endif %}
                {% if variation_dimensions %}
                <div class="sci-info-card">
                    <div class="sci-info-card-label">ğŸ“ Variation Dimensions</div>
                    <div class="sci-info-card-value">{{ variation_dimensions | e }}</div>
                </div>
                {% endif %}
                {% if software_dependencies %}
                <div class="sci-info-card">
                    <div class="sci-info-card-label">ğŸ“¦ Software Dependencies</div>
                    <div class="sci-info-card-value">{{ software_dependencies | e }}</div>
                </div>
                {% endif %}
                {% if documentation %}
                <div class="sci-info-card">
                    <div class="sci-info-card-label">ğŸ“„ Documentation</div>
                    <div class="sci-info-card-value">
                        {% if documentation.startswith('http') %}
                        <a href="{{ documentation | e }}" target="_blank">{{ documentation | replace('https://', '') | e }}</a>
                        {% else %}{{ documentation | e }}{% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endif %}

{# â”€â”€ Code & Development â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% if source_code_repository or shared_code_base or programming_languages or license %}
<section class="emd-section{% if source_code_repository or programming_languages %} expanded{% endif %}">
    <div class="emd-section-header" onclick="toggleSection(this)">
        <div class="emd-section-title-wrapper">
            <div class="emd-section-icon">{{ icons.tech | safe }}</div>
            <h2 class="emd-section-title">Code &amp; Development</h2>
        </div>
        <div class="emd-section-toggle">{{ icons.chevron | safe }}</div>
    </div>
    <div class="emd-section-content">
        <div class="emd-section-body">
            <div class="emd-section-divider"></div>
            <div class="emd-tech-grid">
                {% if source_code_repository %}
                <div class="emd-tech-item">
                    <div class="emd-tech-label">Source Code Repository</div>
                    <div class="emd-tech-value">
                        {% if source_code_repository.startswith('http') %}
                        <a href="{{ source_code_repository | e }}" target="_blank">{{ source_code_repository | replace('https://', '') | e }}</a>
                        {% else %}{{ source_code_repository | e }}{% endif %}
                    </div>
                </div>
                {% endif %}
                {% if shared_code_base %}
                <div class="emd-tech-item">
                    <div class="emd-tech-label">Shared Code Base</div>
                    <div class="emd-tech-value">{{ shared_code_base | e }}</div>
                </div>
                {% endif %}
                {% if programming_languages %}
                <div class="emd-tech-item">
                    <div class="emd-tech-label">Programming Languages</div>
                    <div class="emd-type-badges">
                        {% for lang in programming_languages %}<span class="emd-type-badge">{{ lang | e }}</span>{% endfor %}
                    </div>
                </div>
                {% endif %}
                {% if license %}
                <div class="emd-tech-item">
                    <div class="emd-tech-label">License</div>
                    <div class="emd-tech-value">{{ license | e }}</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endif %}

{# â”€â”€ References â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% set ref_count = references | length if references else 0 %}
<section class="emd-section{% if ref_count > 0 %} expanded{% endif %}">
    <div class="emd-section-header" onclick="toggleSection(this)">
        <div class="emd-section-title-wrapper">
            <div class="emd-section-icon">{{ icons.reference | safe }}</div>
            <h2 class="emd-section-title">References <span class="emd-section-count">({{ ref_count }})</span></h2>
        </div>
        <div class="emd-section-toggle">{{ icons.chevron | safe }}</div>
    </div>
    <div class="emd-section-content">
        <div class="emd-section-body">
            <div class="emd-section-divider"></div>
            {% if references %}
            {% for ref in references %}
            <a href="{{ ref | e }}" class="emd-reference-item" target="_blank">
                <div class="emd-reference-icon">{{ icons.description | safe }}</div>
                <span class="emd-reference-text">{{ ref | e }}</span>
                <span class="emd-reference-arrow">â†’</span>
            </a>
            {% endfor %}
            {% else %}
            <p class="emd-description-text">No references available.</p>
            {% endif %}
        </div>
    </div>
</section>

{# â”€â”€ Technical Details â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<section class="emd-section">
    <div class="emd-section-header" onclick="toggleSection(this)">
        <div class="emd-section-title-wrapper">
            <div class="emd-section-icon">{{ icons.tech | safe }}</div>
            <h2 class="emd-section-title">Technical Details</h2>
        </div>
        <div class="emd-section-toggle">{{ icons.chevron | safe }}</div>
    </div>
    <div class="emd-section-content">
        <div class="emd-section-body">
            <div class="emd-section-divider"></div>
            <div class="emd-tech-grid">
                <div class="emd-tech-item">
                    <div class="emd-tech-label">Resource Identifier (@id)</div>
                    <div class="emd-tech-value">{{ id | e }}</div>
                </div>
                <div class="emd-tech-item">
                    <div class="emd-tech-label">Validation Key</div>
                    <div class="emd-tech-value">{{ validation_key | e if validation_key else 'N/A' }}</div>
                </div>
                <div class="emd-tech-item">
                    <div class="emd-tech-label">JSON-LD Context</div>
                    <div class="emd-tech-value"><a href="{{ context_url | e }}" target="_blank">{{ context_url | replace('https://', '') | e }}</a></div>
                </div>
                <div class="emd-tech-item">
                    <div class="emd-tech-label">Resource Types</div>
                    <div class="emd-type-badges">
                        {% for t in types %}<span class="emd-type-badge">{{ t | e }}</span>{% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block scripts %}
// Apply domain colour to header left border
(function() {
    const pill = document.querySelector('.emd-domain-pill');
    const header = document.querySelector('.emd-header');
    if (pill && header) {
        const color = getComputedStyle(pill).getPropertyValue('--sd-color').trim();
        if (color) { header.classList.add('has-domain'); header.style.setProperty('--sd-color', color); }
    }
})();
const sourceData = {{ raw_json | safe }};
document.addEventListener("copy", function(e) {
    e.preventDefault();
    e.clipboardData.setData("text/plain",
        "// JSON-LD: {{ name | e }}\n// Generated: {{ generated_date }}\n\n" +
        JSON.stringify(sourceData, null, 2));
});
{% endblock %}
