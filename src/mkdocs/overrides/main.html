{% extends "base.html" %}

{% block htmltitle %}
  <title>{% if page.title %}{{ page.title }} | {% endif %}{{ config.site_name }}</title>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    // Logo switching based on color scheme
    function updateLogo() {
      const scheme = document.body.getAttribute('data-md-color-scheme');
      const logos = document.querySelectorAll('.md-logo img');
      logos.forEach(function(logoImg) {
        if (logoImg) {
          if (scheme === 'slate') {
            logoImg.src = logoImg.src.replace('logo-light.svg', 'logo-dark.svg');
          } else {
            logoImg.src = logoImg.src.replace('logo-dark.svg', 'logo-light.svg');
          }
        }
      });
    }
    
    // Add repo link and dark mode toggle to header source area
    function setupHeaderControls() {
      const headerSource = document.querySelector('.md-header__source');
      if (!headerSource) return;
      
      // Check if controls already exist
      if (headerSource.querySelector('.header-repo')) return;
      
      // Get repo URL and name
      const repoUrl = '{{ config.repo_url | default("", true) }}';
      const repoName = '{{ config.repo_name | default("", true) }}';
      
      // Find the palette toggle input
      const paletteInputs = document.querySelectorAll('input[name="__palette"]');
      let toggleInput = null;
      paletteInputs.forEach(function(input) {
        if (!input.checked) {
          toggleInput = input;
        }
      });
      
      // Create container
      const container = document.createElement('div');
      container.style.display = 'flex';
      container.style.alignItems = 'center';
      container.style.gap = '1rem';
      
      // Create repo link with icon
      if (repoUrl) {
        const link = document.createElement('a');
        link.href = repoUrl;
        link.className = 'header-repo';
        link.target = '_blank';
        link.rel = 'noopener';
        link.style.display = 'flex';
        link.style.alignItems = 'center';
        link.style.gap = '0.4rem';
        
        // GitHub icon SVG - 2/3 of 48px = 32px
        const icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        icon.setAttribute('viewBox', '0 0 16 16');
        icon.setAttribute('height', '32');
        icon.style.fill = 'currentColor';
        icon.innerHTML = '<path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>';
        
        const text = document.createElement('span');
        text.textContent = repoName;
        text.style.fontSize = '0.55rem';
        
        link.appendChild(icon);
        link.appendChild(text);
        container.appendChild(link);
      }
      
      // Create dark mode toggle
      if (toggleInput) {
        const toggleLabel = document.createElement('label');
        toggleLabel.htmlFor = toggleInput.id;
        toggleLabel.className = 'header-toggle';
        toggleLabel.style.cursor = 'pointer';
        toggleLabel.style.display = 'flex';
        toggleLabel.style.alignItems = 'center';
        
        const scheme = document.body.getAttribute('data-md-color-scheme');
        const icon = scheme === 'slate' ? '‚òÄÔ∏è' : 'üåô';
        toggleLabel.textContent = icon;
        toggleLabel.style.fontSize = '1.2rem';
        
        container.appendChild(toggleLabel);
      }
      
      headerSource.innerHTML = '';
      headerSource.appendChild(container);
    }
    
    // Update toggle icon when scheme changes
    function updateToggleIcon() {
      const toggle = document.querySelector('.header-toggle');
      if (toggle) {
        const scheme = document.body.getAttribute('data-md-color-scheme');
        toggle.textContent = scheme === 'slate' ? '‚òÄÔ∏è' : 'üåô';
      }
    }
    
    // Run on load
    document.addEventListener('DOMContentLoaded', function() {
      updateLogo();
      setTimeout(setupHeaderControls, 50);
    });
    
    // For instant navigation
    if (typeof document$ !== 'undefined') {
      document$.subscribe(function() {
        updateLogo();
        setTimeout(setupHeaderControls, 50);
      });
    }
    
    // Watch for scheme changes
    new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.attributeName === 'data-md-color-scheme') {
          updateLogo();
          updateToggleIcon();
        }
      });
    }).observe(document.body, { attributes: true });
  </script>
{% endblock %}
