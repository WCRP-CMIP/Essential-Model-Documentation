<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ name | e }} | Model Component</title>
    <link rel="stylesheet" href="../assets/component-page.css">
</head>
<body class="component-page">
    <div class="component-container">
        <header class="component-header">
            <nav class="component-breadcrumb">
                <a href="../">← Back to Documentation</a>
                <span>|</span>
                <a href="https://emd.mipcvs.dev/" target="_blank">EMD Registry</a>
                <span>→</span>
                <a href="https://emd.mipcvs.dev/model_component/" target="_blank">Model Components</a>
                <span>→</span>
                <span>{{ name | e }}</span>
            </nav>
            <div class="component-badge">Model Component</div>
            <h1 class="component-title">{{ name | e }}</h1>
            <p class="component-subtitle">{{ description }}</p>
            <div class="component-header-meta">
                <div class="component-meta-item">
                    <span class="component-meta-label">Family</span>
                    <span class="component-meta-value">{{ family | e if family else 'N/A' }}</span>
                </div>
                <div class="component-meta-item">
                    <span class="component-meta-label">Scientific Domain</span>
                    <span class="component-meta-value">{{ component.title | e }}</span>
                </div>
                <div class="component-meta-item">
                    <span class="component-meta-label">Code Base</span>
                    <span class="component-meta-value">
                        {%- if code_base.is_private -%}
                            Private
                        {%- elif code_base.is_url -%}
                            <a href="{{ code_base.value | e }}" target="_blank">{{ code_base.value | e }}</a>
                        {%- elif code_base.value -%}
                            {{ code_base.value | e }}
                        {%- else -%}
                            Not specified
                        {%- endif -%}
                    </span>
                </div>
                <div class="component-meta-item">
                    <span class="component-meta-label">Context</span>
                    <span class="component-meta-value"><a href="{{ context_url | e }}" target="_blank">JSON-LD →</a></span>
                </div>
            </div>
        </header>

        <main>
            {# Description Section #}
            {% call section("Description", icons.description, expanded=true) %}
                <p class="component-description-text"><strong>{{ name | e }}</strong> — {{ description_highlighted | safe }}</p>
            {% endcall %}

            {# Scientific Domains Section #}
            {% call section("Scientific Domains", icons.domains, expanded=true) %}
                <div class="component-domain-grid">
                    {# Primary component domain #}
                    {{ domain_card(component.title, "Component", component.id, "Primary scientific domain for this model component.", component.aliases) }}
                    
                    {# Embedded in domain (if exists) #}
                    {% if embedded_in %}
                    {{ domain_card(embedded_in.title, "Embedded In", embedded_in.id, name ~ " operates embedded within this component.", embedded_in.aliases) }}
                    {% endif %}
                </div>
            {% endcall %}

            {# Computational Grids Section #}
            {% call section("Computational Grids", icons.grids, expanded=true) %}
                {% if grids.horizontal or grids.vertical %}
                <p class="component-grid-info-text">Computational grid specifications for this model component.</p>
                <div class="component-grid-specs">
                    {% if grids.horizontal %}
                    <div class="component-grid-spec-card">
                        <div class="component-grid-spec-header">
                            <div class="component-grid-spec-label">Horizontal Grid</div>
                            <div class="component-grid-spec-value">{{ grids.horizontal | e }}</div>
                        </div>
                        <p class="component-grid-spec-desc">Horizontal spatial discretization identifier.</p>
                    </div>
                    {% endif %}
                    {% if grids.vertical %}
                    <div class="component-grid-spec-card">
                        <div class="component-grid-spec-header">
                            <div class="component-grid-spec-label">Vertical Grid</div>
                            <div class="component-grid-spec-value">{{ grids.vertical | e }}</div>
                        </div>
                        <p class="component-grid-spec-desc">Vertical level structure identifier.</p>
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <p class="component-description-text" style="color: var(--md-default-fg-color--lighter);">No grid specifications available.</p>
                {% endif %}
            {% endcall %}

            {# Coupling Section #}
            {% call section("Coupling", icons.coupling) %}
                {% if coupled_with %}
                <p class="component-description-text" style="margin-bottom: 1rem;"><strong>{{ name | e }}</strong> is coupled with the following domains:</p>
                <div class="component-domain-grid">
                    {% for item in coupled_with %}
                    {{ domain_card(item.title, "Coupled", item.id, name ~ " is coupled with this domain.", item.aliases) }}
                    {% endfor %}
                </div>
                {% else %}
                <div class="component-coupling-status">
                    <span>○</span>
                    <span>No external coupling</span>
                </div>
                {% endif %}
            {% endcall %}

            {# Technical Details Section #}
            {% call section("Technical Details", icons.technical) %}
                <div class="component-tech-grid">
                    <div class="component-tech-item">
                        <div class="component-tech-label">Resource Identifier (@id)</div>
                        <div class="component-tech-value">{{ id | e }}</div>
                    </div>
                    <div class="component-tech-item">
                        <div class="component-tech-label">Validation Key</div>
                        <div class="component-tech-value">{{ validation_key | e if validation_key else 'N/A' }}</div>
                    </div>
                    <div class="component-tech-item">
                        <div class="component-tech-label">JSON-LD Data</div>
                        <div class="component-tech-value"><a href="{{ context_url | e }}" target="_blank">{{ context_url | replace('https://', '') | e }}</a></div>
                    </div>
                    <div class="component-tech-item">
                        <div class="component-tech-label">Resource Types (@type)</div>
                        <div class="component-type-badges">
                            {% for t in types %}
                            <span class="component-type-badge">{{ t | e }}</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endcall %}

            {# References Section #}
            {% call section("References", icons.references) %}
                {% if references %}
                {% for ref in references %}
                <a href="#" class="component-reference-item">
                    <div class="component-reference-icon">{{ icons.document | safe }}</div>
                    <span class="component-reference-text">{{ ref | e }}</span>
                    <span class="component-reference-arrow">→</span>
                </a>
                {% endfor %}
                {% else %}
                <p class="component-description-text" style="color: var(--md-default-fg-color--lighter);">No references available.</p>
                {% endif %}
            {% endcall %}
        </main>

        <footer class="component-footer">
            <p class="component-footer-text">Data sourced from <a href="https://emd.mipcvs.dev/" class="component-footer-link" target="_blank">EMD Registry</a> · Part of the <a href="https://wcrp-cmip.org/" class="component-footer-link" target="_blank">WCRP CMIP</a> initiative</p>
        </footer>
    </div>
    
    <script>
    // Toggle section expand/collapse
    function toggleSection(header) { 
        header.parentElement.classList.toggle('expanded'); 
    }
    
    // JSON-LD source data for this component
    const sourceData = {{ raw_json | safe }};
    
    // Copy protection - provide JSON-LD data instead of page content
    const handleCopy = function(e) {
        e.preventDefault();
        const jsonString = JSON.stringify(sourceData, null, 2);
        const copyText = `// JSON-LD Source Data for {{ name | e }}
// From: https://emd.mipcvs.dev/model_component/{{ id | e }}.json
// EMD Registry: https://emd.mipcvs.dev/

${jsonString}`;
        e.clipboardData.setData("text/plain", copyText);
    };
    
    document.addEventListener("copy", handleCopy);
    </script>
</body>
</html>
